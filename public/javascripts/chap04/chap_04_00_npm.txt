chap04는 npm(Node Package Manager)를 사용하여 확장 모듈을 사용/관리 하는 방법을 알아본다.
npm은 Node의 표준이므로 Node프로그래밍을 하려면 필수적으로 알야야할 도구다.

Node생태계에서는 수많은 개발자가 확장모듈을 생산/등록하여 사용한다.
이러한 확장모듈을 관리하는 도구가 npm이다.
html을 javascript를 사용할수도 있지만, Jquery나 ProtoTYpe을 사용하여 더욱 편리하게 사용한다.
Node도 여러가지 확장모듈을 이용하면 더욱 편리하게 프로그램을 개발하여 개발생산성을 높일수있다.
Java 개발자라면 Maven, gradle를 이용하여 의존성을 가져오고 활용하는 방식과 유사하다.

npm은 모든사용자가 접근할수있는 중앙저장소를 제공하고 , Node개발자가 만든 모듈을 패키징해 중앙저장소에 등록할수도 있다.
npm은 package.json이라는 파일에 프로젝트관련 해서 Node Package정보를 가지고있다.
Node개발자는 package.json파일만 공유하면 자신의 Local환경에 필요한 모듈을 설치할수있다.
( maven의 pom.xml , gradle의 build.gradle와 유사한것 같아보인다.)

Node 0.6.3 이후부터는 npm이 노드에 포함됐다.
Node가 설치된 폴더로 이동하면 mpm이 설치됐음을 확인할수있고, 어디서나 npm 명령어를 사용할수있다.
cmd창에서 npm -v를 입력후 엔터를 눌러보자
~~~> npm -v
11.5.2

파라미터없이 npm만 입력하면 사용할수있는 명령어 옵션 목록을 볼수있다.


 ====================           확장 모듈 설치             ====================

npm확장모듈의 설치는 글로벌 설치와 로컬설치로 나눈다.
커맨드라인(cmd)에서 설치하는것을 글로벌 설치하하고
require()로 접근한다면 로컬설치라 한다.
글로벌 설치를 하면 /usr/local/lib하위에 node_modules아래에 설치되고
로컬 설치를 하면 현재위치기준으로 node_modules디렉토리에 설치된다.
Window사용자는 C:\Users\PC\AppData\Roaming\npm\node_modules 에 설치된다.



글로벌 설치는 $ npm install nodemon -g 형태로 -g옵션으로 설치할수있다.
실제로 cmd창에서 npm install modemon -g를 입력해보자

C:\Users\PC>npm install nodemon -g
added 30 packages in 18s

설치된 package는 npm list -g 명령어로 package list를 확인할수있다.
C:\Users\PC>npm list -g
C:\Users\PC\AppData\Roaming\npm
+-- @nestjs/cli@11.0.10
+-- nodemon@3.1.11
`-- npm@11.5.2


로컬설치는 보통 소스에서 사용해야 하는 확장모듈에서 사용한다.
방법은  cmd창에서 npm install request 처럼 -g옵션없이 수행하면 된다.
설치확인은 npm list 로 입력한다. 마찬가지로 -g옵션없이 수행하면 된다.

설치된 모듈은 모듈명@버전 형식으로 출력되고 프로젝트의 root 디렉토리에 node_modules 디렉토리 아래에 설치된다.

한번에 여러개의 모듈을 설치해야 할경우
npm install module1 module2 module3 형식으로 연속으로 입력하면 된다.


 ====================           확장 모듈 검색             ====================

확장모듈을 설치하려면 어떤기능의 확장 모듈이있는지 인지하고, 판단할줄 알아야 한다.
npm중양저장소에 모듈이 존재하는지도 알아야 한다. 구글 검색엔진으로 'node_js' 키워드와 함꼐 검색하면 원하는 모듈을 찾을수도 있다.
npm중앙저장소에 등록된 모듈을 검색할수있는 npm registry (http://search.npmjs.org/) 사이트도 제공한다.
2025.11월 현재는 https://www.npmjs.com/에서 npm package검색이 가능하다.
구글에서 'node.js 유용한 패키지 추천' 검색해도 많이 나온다.

cmd창에서 npm search 키워드로 검색을 해도 찾을수있다. 최초 검색시 확장모듈의 인덱스를 로컬에 저장하기때문에 시간이 조금 걸릴수있다.
이후부터는 더욱 npm search 명령은 더욱 빠르게 동작한다 .

npm info 키워드로 node package의 상세한 정보를 확인할수도 있다.
ex) > npm search express
    > npm info express
    > npm info @types/express

 ====================           설치된 확장 모듈관리             ====================

npm은 기존에 설치한 모듈도 업데이트기능을 제공한다.
    > npm update 모듈명

지정한 모듈의 새버전이 있을떄는 새버전으로 업데이트하고 없으면 아무일도 하지 않는다.
글로벌로 설치한 모듈을 업데이트 하려면 -g옵션을 붙이면 된다.
    > npm update 모듈명 -g

특별히 모듈명을 지정하지 않고 로컬에 설치된 모듈 전체를 업데이트 하려면 모듈명없이 update를 수행하면 된다.
    > npm update
글로벌로 설치한 모듈전체를 업데이트 하려면 -g옵션을 붙이면 된다.
    > npm update -g
프로젝트 상황에 따라 호환성을 위해 특정 버전으로 설치해야 하는경우가 있다. 그땐 모듈명@버전 옵션으로 설치 가능하다.
    > npm install 모듈명@버전
 ex > npm install request@2.9.0
 버전 명시(모듈명@버전)는 npm update 명령에서는 동작하지 않는다.

 모듈이 더이상 필요하지 않아 설치를 삭제 하려면 uninstall 명령어를 사용하면 된다.
    > npm uninstall 모듈명


 ====================           package.json을 이용한 프로젝트 관리             ====================

 Node로 확장모듈을 작성하면 npm을 이용해 중앙저장소로 배포할수도 있다.
 배포할때 모듈에 대한 정보를  package.json에 저장한다.
 앞에서 언급한 npm search 나 npm info에서 제공하는 정보도 package.json에서 저장된 정보다.

 package.json은 활장모듈의 배포를 위해 만들었지만, application 제작할떄도 package.json을 이용해 관리할수도 있다.
 package.json의 구문 규칙은 npm에서 마음대로 정하는것이 아니라. CommonJS의 Package/1.0 명세된 규칙을 따른다.
 간단한 package.json내용을 보자

  { "name" : "opennote-testnode"
  , "version" : "0.0.1"
  , "private" : true
  , "dependencies" : {
        "express" : "2.4.6"
      , "jade" : ">= 0.0.1"
     }
    , author : {
        "name : "opennote"
       , "email" : "poptome@opennote.co.kr"
       , "url" : "http://www.opennote.co.kr"
     }
  }

   === package.json 주요속성  ===
  name : 프로젝트 이름이다. (중앙저장소에 배포시 name, version은 필수항목이다. 여기 name이 모듈의 이름이된다.  )
  version : 프로젝트의 버전이다. (중앙저장소 배포시 필수항목 이다.)
  description : 프로젝트의 설명이다. (npm search 명령에서 검색되는 부분이다. )
  keyword :  프로젝트의 키워드를 문자열의 배열로 작성한다.  ex) ['twitter', 'streaming','oauth']
  homepage : 프로젝트의 홈제이지 주소
  author : 모듈 제작자 정보
  contributors : 프로젝트 참여한 공헌자 정보다. author의 정보와 같으며 배열형태다.
                 ex) [{author},{author}]
  repository : 소스를 확인할수있는 저장소의 주소를 입력한다.
                 ex) "repository" : { "type" : "git"
                                    , "url" : "http://git-repository-url"
                      }
  scripts : 프로젝트에 자주실행해야 하는 명령어를 scripts에 작성하면 npm명령어로 실행할수있다.
                 ex) { "scripts" : { "start" : "node app.js"
                                 , "install" : "make & make install"
                                 , "test" : "node ./test/"
                       }
                     }
            이런식으로 입력하면 명령어에서 node app.js로 입력하는 대신 npm start로 대신 실행할수있다.
            명령어는 예약된 명령어가 있는데 "start"는 prestart , start , poststart가 순차적으로 실행되며
            test 는 pretest, test , posttest 명령이 순차적으로 실행된다.

  config :   앞서 설만한 scripts를 사용해서 npm start등으로 실행하면 소스에서 config 필드에있는 값을
             환경변수처럼 접근할수있다.
             {"config" : { "port" : "8080"
                         }
             }
  private : true값으로 지정하면 이프로젝트를 npm 중앙 저장소에 배포하지 않는다.
            실수로라도 배포되는것을 방지하려면 true로 설정하는것이 좋다.
  dependencies : 배포할 목적이 아니라면 지금까지 설명한 필드는 대부분 정보성이므로 유용하지 않다.
           dependencies를 사용하면 모듈의 의존성관리를 할수있기때문에 유용하다.
           npm으로 필요한 확장성 모듈을 수동으로 설치햇다면 개발자들간의 버전차이로 문제가 발생할수있다.
           여기서 의존성관리 모듈을 통합 관리하므로 프로젝트 수행시 일관된 개발환경을 갖출수있다.
           {"dependencies" : { "express" : "2.4.6"'
                             , "jade" : ">= 0.0.1"
             }
           }
           express, jade가 모듈명이고 뒤에있는 값이 버전정보다.
           버전정보는   version : 버전과 일치하는 모듈을 설치한다.
                     =version : 버전과 일치하는 모듈을 설치한다.
                     >version : 버전코다 큰 최신 모듈을 설치한다.
                     >=version : 버전보다 크거나 같은 모듈을 설치한다.
                     <version : 버전보다 작은 버전의 모듈을 설치한다.
                     <=version : 버전보다 작거나 같은 버전의 모듈을 설치한다.
                     ~version : 버전의 범위를 설정할수있다. 3단계 버전형식을 사용할수있다.
                                ~1      : 1버전이상 ~ 2버전 미만
                                ~1.2    : 1.2버전이상 ~ 1.3버전 미만
                                ~1.2.3  : 1.2.3버전이상 ~ 1.2.4버전 미만
                     version.x : 버전의 형식에 맞는 최신 버전을 설치
                                 ex) 1.3.x 는 1.3버전중에 가장최선 버전을 설치
                               : 별도의 버전을 명시하지않으면 가장 최신버전을 설치한다.
                            "" : 빈문자열로 입력해도, 명시하지 않은것과 마찬가지고 가장 최신버전을 설치한다.
  devdependencies : 개발할때만 필요한 모듈을 명시한다. 기본값은 false이다.
                    여기에 명시된 모듈은 config에 production 이 true로 돼있을떄는 설치하지 않는다.


  package.json 자동생성
       JSON형식은 간단한 포맷이지만 프로젝트를 만들떄마다 작성하는것은 번거로운일이다.
       npm init 명령을 사용하면 기본적인 package.json파일을 만들수있다.
       생성시 추가로 npm install 모듈 설치시 --save옵션을 사용하면 package.json의 dependencies에 자동으로 추가된다.


 ====================          정리             ====================
  1. npm은 node의 모듈을 관리한다. (Node Package Manager)
  2. npm은 확장모듈을 로컬설치과 글로벌설치로 나눈다.    (글로벌 설치 옵션 = -g)
  3. 커맨드 라인에서 영열어로 사용하는 확장모듈은 글로벌로 설치하고  -g옵션을 사용한다.
  4. 소스에서 require('')로 사용하는 확장 모듈은 로컬로 설치하고 npm install 모듈명 명령어를 사용한다.
  5. npm list나 npm list -g로 설치된 확장모듈을 확인할수있다.
  6. npm search 명령어로 원하는 모듈을 검택하고 npm info로 확장모듈의 상세정보를 확인할수있다.
  7. 설치한 확장 모듈을 업데이트 하려면 npm update명령어를 사용한다.
     모듈명이 없으면 모듈전체를 업데이트 한다.
  8. 확장 모듈을 삭제하려면 npm uninstall 모듈명을 사용한다 .
  9. 프로젝트 Root 디렉토리(폴더)에 package.json 파일을 두고 프로젝트 정보를 관리할수있다.
  10. package.json의 dependencies 필드에 확장 모듈을 저장하면 npm install 이나 npm update만으로
      의존성 모듈을 설치및 업데이트 할수있다.

